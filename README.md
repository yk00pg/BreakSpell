# BreakSpell

## はじめに
- 本リポジトリは、Java学習者の「ゆうき」（Xアカウント： [@yk00pg](https://x.com/yk00pg)）が作成したMinecraftプラグイン『BreakSpell（呪いを解いて！）』に関するものです
- ご利用いただくことによるトラブル等につきましては、一切の責任を負いかねますことを予めご了承ください
<br/>

## 目次
- [コンセプト](#コンセプト)
- [概要](#概要)
- [想定ユーザー](#想定ユーザー)
- [開発環境・使用技術](#開発環境使用技術)
- [プレイ動画](#プレイ動画)
- [留意事項](#留意事項)
- [遊び方](#遊び方)
- [ゲームの難易度](#ゲームの難易度)
- [導入方法](#導入方法)
- [工夫したところ](#工夫したところ)
- [今後実装予定の機能](#今後実装予定の機能)
- [おわりに](#おわりに)
- [Appendix](#appendix)
<br/>

## コンセプト
- JavaにおけるStream APIのより実践的な理解やO/Rマッパーを用いたDB処理への理解を深めるために、Minecraftプラグインを活用して実装しました
- 「**神経衰弱ゲーム × ファンタジー**」をテーマにしたMinecraft内で遊べるミニゲームです
- 神経衰弱ゲームを作るにあたり、カードをめくって数字や絵柄を確認するように、ペアが揃ったことが目に見えてわかる形にしたいと考えました
- 「めくると見える → クリックすると現れる → 姿が変わる」と連想し、ファンタジー要素を盛り込んでお伽噺のような物語性を持たせたら面白いのではないかと思い、作成しました
- 実装するうえで工夫したところは[こちら](#工夫したところ)（本READMEの後半セッション）に詳細をまとめています
<br/>

## 概要
- プレイヤーがメインハンドに渡された魔法の本を書見台に置くことで魔法が起動し、ゲームを開始します
- 魔法の本の力で魔法が使えるようになったプレイヤーは、メインハンドに渡された魔法の杖を振って呪文を唱え（右クリック）、呪いをかけられたエンティティが真の姿に戻る手助けをします
- 同じ真の姿を持つエンティティを連続して見つけると、魔法×絆の力で呪いが解け、エンティティが解放されてポイントが入ります
- コマンドを実行またはゲームメニューGUIをクリックすることでゲームを実行することができます
- ゲームのスコアはDBに保存され、コマンドを実行またはスコアメニューGUIをクリックすることでリスト形式で表示することができます
<br/>

## 想定ユーザー
- ファンタジーやお伽話の世界観が好きなプレイヤー
- MinecraftのMobキャラクターが好きなプレイヤー
<br/>

## 開発環境・使用技術
- 開発言語: Java Oracle OpenJDK 21.0.9
- アプリケーション: Minecraft 1.21.4
- サーバー: Spigot 1.21.4
- Docker: 28.1.1
- MySQL: 8.0.42
- MyBatis: 3.5.19
- 検証済みOS: Mac OS Sequoia 15.4.1 (24E2653)
<br/>

## プレイ動画
- 音響効果を加えているため、ゲーム内の音声をそのまま収録しております<br/>
  差し支えなければ音声をオンにしてご視聴いただけますと幸いです

https://github.com/user-attachments/assets/85456d0c-ac5c-4335-b6ec-2b89728b70e4

<br/>

## 留意事項
- 35ブロック四方以上の広さの平地でゲームを実行するようにしてください
  - エンティティは書見台の方向（プレイヤーの北側）に出現します（ハードモードの場合: X軸±15、Z軸-33の範囲）
  - 設置された書見台の位置を見て、方向が合わないと感じられましたら、自動キャンセルをお待ちください
- ゲームを実行すると一時的にメインハンドのアイテムをお預かりし、ゲーム終了後にお返しするように設計しておりますが、<br/>
  予期せぬアクシデントを回避するため、念のため予めメインハンドを空けておいていただくことを推奨いたします
<br/>

## 遊び方
### 1.　ゲームを実行する
- いずれかの方法でゲームを実行します
  - `/chanting` コマンドを実行してゲームメニューを開き、難易度を選択して実行
  - `/chanting` コマンドの引数に難易度 `[easy, normal, hard]` を指定して実行

    | コマンド | 説明 |
    |:--|:--|
    | `/chanting` | ゲームメニューGUIを開く |
    | `/chanting easy` | イージーモードでゲームを実行する |
    | `/chanting normal` | ノーマルモードでゲームを実行する |
    | `/chanting hard` | ハードモードでゲームを実行する |
    | `/chanting stop` | 実行中のゲームを中止する |
    
>[!NOTE]
>初回はイージーモードのみプレイ可能です<br/>
>イージーモードをプレイするとノーマルモードが、ノーマルモードをプレイするとハードモードが解放されます
<br/>

### 2. ゲームを開始する
- ゲームを実行すると初回プレイ時のみプロローグが書かれた本が表示されます<br/>
  （プロローグはゲームメニューGUIからいつでも読み返すことができます）
- メインハンドに渡された魔法の本を書見台に置くとゲーム開始までのカウントダウンが始まります
- 10秒以内（初回プレイ時は30秒以内）に書見台に魔法の本が置かれなかった場合は、自動でキャンセルされます
<br/>

### 3. ペアを見つける
- ゲーム開始とともに難易度に応じて呪いをかけられた姿のエンティティが出現します
- エンティティを右クリックしてメインハンドに渡された魔法の杖を振り呪文を唱えると、真の姿に戻ります
- 連続して同じ真の姿を持つエンティティを見つけることができればエンティティが呪いから解放され、ポイントが入ります
- 残り時間が0になるか、すべてのペアを見つけるとゲーム終了です
<br/>

### 4. スコアを確認する
- いずれかの方法でゲームのスコアをリスト形式で表示することができます
  - `/score` コマンドを実行してスコアメニューを開き、スコアの種類を選択して表示
  - `/score` コマンドの引数にスコアの種類 `[new, rank, easy, normal, hard]` を指定して表示

    | コマンド | 説明 |
    |:--|:--|
    | `/score` | スコアメニューGUIを開く |
    | `/score new` | 最近登録されたスコアを最大5件表示する |
    | `/score rank` | 全難易度のスコアを高い順に5件表示する |
    | `/score easy` | イージーモードのスコアを高い順に5件表示する |
    | `/score normal` | ノーマルモードのスコアを高い順に5件表示する |
    | `/score hard` | ハードモードのスコアを高い順に5件表示する |

https://github.com/user-attachments/assets/82e36cd9-e445-47aa-8a80-f7f4bd5753d0

<br/>

## ゲームの難易度
- ゲームはイージーモード、ノーマルモード、ハードモードに分かれており、それぞれ次のような違いがあります

**< 制限時間 と 出現するエンティティ >**
| 難易度 | 時間 | 出現数 | ペア数 | 呪いをかけられた姿 | スペシャルエンティティ |
|:-:|:--|:--|:--|:--|:--|
| イージー | 30秒 | 11体 | 5ペア  | ゾンビ | 時間UP×1 |
| ノーマル | 90秒 | 25体 | 10ペア | ゾンビ, ウィザースケルトン | 時間UP×2、時間DOWN×2、シャッフル×1 |
| ハード | 180秒 | 48体 | 20ペア | ゾンビ, ウィザースケルトン, クリーキング | 時間UP×3、時間DOWN×3、シャッフル×2 |
<br/>
  
**< 獲得できるポイント >**
| 難易度 | 通常ポイント | タイムボーナス | コンボボーナス (1コンボ→2コンボ→3コンボ→4コンボ→5コンボ以降) |
|:-:|:--|:--|:--|
| イージー | 5点 | ×1.0 | なし |
| ノーマル | 10点 | ×1.5 | ×1.0 → ×1.5 → ×2.0 → ×2.5 → ×3.0 |
| ハード | 20点 | ×2.0 | ×1.0 → ×2.0 → ×3.0 → ×4.0 → ×5.0 |
- タイムボーナス: 制限時間内にすべてのペアを見つけた場合、残り時間にタイムボーナスを掛け合わせたポイントをスコアに加算
- コンボボーナス: 連続でペアが揃った場合、連続ペア（コンボ）数に応じたコンボボーナスを掛け合わせたポイントをスコアに加算
  
<br/>

## 導入方法
### 1. 環境の準備
- Minecraftサーバーを用意してください
- Docker Desktopをインストールしてください
- 本リポジトリをクローンしてください
<br/>

### 2. データベースの準備
- 以下のファイルに記載の `Your_PW` をご自身のパスワードに変更してください
  - docker/.env
  ```.env
  MYSQL_ROOT_PASSWORD=Your_PW
  ```
  - resources/mybatis-config.xml
  ```.xml
  <property name="password" value="Your_PW"/>
  ```
>[!CAUTION]
>サンプルとして仮のパスワード `Your_PW` を設定しております<br/>
>実際に使用される際は、**必ずご自身で安全なパスワードにご変更ください** <br/>
>公開リポジトリに含まれる初期値をそのまま使用すると、第三者にアクセスされるリスクがあります
<br/>

- Macの場合はターミナル、Windowsの場合はコマンドプロンプトなどで下記のコマンドを実行してください<br/>
  ※ データベースの初期設定には10〜20秒ほど時間がかかる場合がございます
```bash
# プロジェクトのdockerディレクトリに移動
cd {プロジェクトのdockerディレクトリのパス}

# プロジェクトのdockerディレクトリで実行
docker compose up -d
```
**（補足）**
- データベースの初期設定が完了しているかは、下記のコマンドで確認することができます
- player_scoreテーブル、player_progressテーブルが作成されていれば成功です
```bash
# dockerコンテナに作成したMySQLに接続
docker exec -it break_spell_db mysql -u root -p

# パスワードを入力後、データベースが作成されているか確認
SHOW DATABASES;

# 作成されていたら、break_spellを選択し、テーブルが作成されているか確認
USE break_spell;
SHOW TABLES;
```
<br/>

### 3. プラグインの準備
- gradle shadowJarを実行し、「 _build/libs/_ 」に本プラグインのfat Jarファイルを作成してください
- 1.で用意したMinecraftサーバーの「_plugins_ 」フォルダに作成したfat Jarファイルを追加してください
<br/>

### 4. サーバーの起動
- サーバーおよびMinecraftを起動し、実行確認をしてください
<br/>

## 工夫したところ
**ゲーム性と物語性のバランス**
- ゲーム性を高めつつ、「呪いをかけられた動物たちを救い出す」という物語性を損なわないように両者のバランスを考えて設計しました
  - 連続してペアを揃えるという神経衰弱のルールをファンタジーの世界観に落とし込み、魔法の杖と呪文だけでは完全に呪いを解くことができず、絆の力（ペアを揃えること）が必要、というコンセプトにしました
  - 獲得したスコアの加算はスコアボードの表示に限定することで、ゲーム性に偏りすぎず、ファンタジーの世界観や物語性を保てるようにしました

**演出と没入感**
- ゲームの進行に応じて、視覚効果（パーティクルなど）や音響効果（サウンド）を適切に使い分け、プレイヤーが「魔法を使っている」ような体験を得られるように工夫しました
  - エンティティを右クリックする際に、メインハンドに持たせた魔法の杖を振る動作を加え、魔法をかけているように見えるようにしています
  - プレイヤーが魔法をかけた動物たちの"呪い"が解ける過程を演出により明示することで、プレイヤーも「物語の登場人物である」という感覚を与えられるようにしました
  - エンティティの動作を完全に制御するのではなく一部に限定することで、「助けを求めている」ように見えるように意識しました
 
**ユーザビリティへの配慮**
- ゲームの実行やスコアリストの表示をコマンド実行とGUIクリックの2通り用意することで、ショートカット実行操作をしたいプレイヤーも直感的に操作したいプレイヤーも操作しやすいようにしています
- 繰り返しプレイすることを想定し、ゲーム開始時およびゲームクリア時の演出（プロローグ・エピローグ）を初回のみに限定することで、テンポ良くプレイできるようにしました
- プロローグ・エピローグをゲームメニューGUIから読み返すことができるようにすることで、物語への理解を深められるようにしています
- ゲーム実行中の操作を制限（アイテムをドロップできないようにするなど）し、意図せぬ操作によりプレイ体験を邪魔されることがないようにしています

**可読性・保守性・再利用性を意識したコード設計**
- 各クラスの責任や役割が明確になるように意識しました
- クラス内においても、処理ごとにメソッドを細分化あるいはまとめることで、各メソッドの役割が明確になるように心がけました
- enumや定数クラスを活用することで、ゲームの難易度やメニューGUI、視覚効果や音響効果などの設定変更を簡易に行えるようにしています
<br/>

## 今後実装予定の機能
- ゲームの一時停止機能
- ゲーム中断時のデータセーブ機能
- セーブしたデータの読み込みおよびゲーム再開機能
- ゲームエリアの作成補助機能
<br/>

## おわりに
- Java学習のアウトプットとして、本リポジトリを公開させていただきました
- ご感想やコメントなどがございましたら、[Xアカウント](https://x.com/yk00pg)までご連絡いただけますと幸いです
<br/>

## Appendix
- [開発メモ](https://befitting-mandible-2e9.notion.site/Minecraft-1f9a8c648d1a8030b5f5e0499cf6b742?source=copy_link)（アイディア出しや要件定義など）
- Qiita記事（【（Mac） Docker × MySQL × MyBatis】MyBatisと連携させたアプリケーションから、コンテナ内のDBへ接続する）
  - [①コンテナ作成編](https://qiita.com/yk00pg/items/4bc6e5d512b6363bbd7b)
  - [②コンテナ接続編](https://qiita.com/yk00pg/items/3c0613c91ec15ed7f212)
  - [③番外編](https://qiita.com/yk00pg/items/5301425f34ceb1e79f96)
<br/>
<br/>

最後までお読みいただきありがとうございました。
